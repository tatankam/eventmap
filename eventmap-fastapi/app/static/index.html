<!DOCTYPE html>
<html>
<head>
    <title>Event Map</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        label { display: block; margin-top: 10px; }
        #map-events { display: flex; gap: 20px; margin-top: 20px; }
        #map-container, #event-list { border: 1px solid #ccc; padding: 10px; }
        #map-container { flex: 2; min-width: 600px; height: 450px; }
        #event-list { flex: 1; height: 450px; overflow-y: scroll; }
    </style>
</head>
<body>
    <h1>Event Map</h1>
    <form id="search-form">
        <label>Origin Address: <input type="text" id="origin" value="Borgo Trento, Verona, Italy" size="50"></label>
        <label>Destination Address: <input type="text" id="destination" value="Piazza dei Signori, Treviso, Italy" size="50"></label>
        <label>Buffer Distance (km): 
            <select id="buffer">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3" selected>3</option>
                <option value="5">5</option>
                <option value="10">10</option>
            </select>
        </label>

        <!-- New datetime input fields -->
        <label for="startinputdate">Start Date and Time:</label>
        <input type="datetime-local" id="startinputdate" name="startinputdate" required>

        <label for="endinputdate">End Date and Time:</label>
        <input type="datetime-local" id="endinputdate" name="endinputdate" required>

        <button type="submit">Create Map</button>
    </form>
    <div id="map-events"></div>

    <script>
        const form = document.getElementById('search-form');
        const mapEventsDiv = document.getElementById('map-events');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            const origin = document.getElementById('origin').value;
            const destination = document.getElementById('destination').value;
            const buffer = document.getElementById('buffer').value;
            const startinputdate = document.getElementById('startinputdate').value;
            const endinputdate = document.getElementById('endinputdate').value;

            mapEventsDiv.innerHTML = "Loading...";

            try {
                const response = await fetch('/create_map', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        origin_address: origin,
                        destination_address: destination,
                        buffer_distance: parseInt(buffer),
                        startinputdate: startinputdate,
                        endinputdate: endinputdate
                    }),
                });
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const html = await response.text();
                mapEventsDiv.innerHTML = html;
            } catch (error) {
                mapEventsDiv.innerHTML = "Error: " + error.message;
            }
        });
    </script>
</body>
</html>
